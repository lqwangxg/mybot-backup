{
  "adapter": [
    "default",
    "Web Adapter"
  ],
  "description": "お客様情報を取得用ダイアログ",
  "type": "dialog",
  "id":"confirm_userinfo",
  "script":[
    { 
      "topic": "default",
      "type": "ask", 
      "text": "先ず、お名前を教えていただけませんか？", 
      "quick_replies": [
        {
          "title": "はい",
          "payload": "はい",
          "content_type": "text"
        },
        {
          "title": "匿名",
          "payload": "匿名",
          "content_type": "text"
        }
      ],
      "collect":{
        "key": "username",
        "options":[]        
      }
    },
    {"type": "comment", "data":"====================================="},
    { 
      "type": "question",
      "text":"「姓　名」の形でご入力をお願い致します。例：桃　太郎",
      "collect":{
        "key": "username",
        "options":[
          {
            "type":"regex",
            "pattern":".+",
            "action":"question_telno"
          },
          {
            "default":"true",
            "action":"repeat"
          }
        ]
      },
      "thread_name":"question_username"
    },
    {"type": "comment", "data":"====================================="},
    { 
      "type": "action",
      "action":"question_mail",
      "thread_name":"question_username"
    },
    {
      "type": "question", 
      "text": "「{{vars.username}}」様のメールアドレスを教えていただけませんか？",
      "quick_replies": [
        {
          "title": "回答無し",
          "payload": "回答無し",
          "content_type": "text"
        }
      ],
      "collect":{
        "key":"mail",
        "options":[
          {
            "type":"regex",
            "pattern":"[a-zA-Z]+[\\w\\.\\-]*@[a-zA-Z]+[\\w\\.\\-]*[a-zA-Z]+",
            "action":"question_telno"
          },
          {
            "type":"string",
            "pattern":"回答無し",
            "action":"question_telno"
          },
          {
            "default":"true",
            "action":"repeat"
          }
        ]
      },
      "thread_name":"question_mail"
    },
    {"type": "comment", "data":"====================================="},
    {"type": "comment", "data":"====================================="},
    {
      "type": "question", 
      "text": "「{{vars.username}}」様のお電話番号を教えていただけませんか？",
      "quick_replies": [
        {
          "title": "回答無し",
          "payload": "回答無し",
          "content_type": "text"
        }
      ],
      "collect":{
        "key":"telno",
        "options":[
          {
            "type":"regex",
            "pattern":"[\\d\\-]{3,}",
            "action":"question_all_confirm"
          },
          {
            "type":"string",
            "pattern":"回答無し",
            "action":"question_all_confirm"
          },
          {
            "default":"true",
            "action": "repeat"
          }
        ]
      },
      "thread_name":"question_telno"
    },
    {"type": "comment", "data":"====================================="},
    {"type": "comment", "data":"====================================="},
    {
      "type": "question", 
      "text": "「{{vars.username}}」様のメールアドレスは「{{vars.mail}}」で、電話番号は「{{vars.telno}}」で、よろしいでしょうか?",
      "quick_replies": [
        {
          "title": "はい",
          "payload": "はい",
          "content_type": "text"
        },
        {
          "title": "姓名修正",
          "payload": "姓名修正",
          "content_type": "text"
        },
        {
          "title": "メール修正",
          "payload": "メール修正",
          "content_type": "text"
        },
        {
          "title": "電話番号修正",
          "payload": "電話番号修正",
          "content_type": "text"
        }
      ],
      "collect":{
        "options":[
          {
            "type": "string",
            "pattern":"はい",
            "action":"userinfo_confirm_completed"
          },
          {
            "type": "string",
            "pattern":"姓名修正",
            "action":"question_username"
          },
          {
            "type": "string",
            "pattern":"メール修正",
            "action":"question_mail"
          },
          {
            "type": "string",
            "pattern":"電話番号修正",
            "action":"question_telno"
          },
          {
            "default": true,
            "pattern": "default",
            "action": "userinfo_confirm_completed"
          }
        ]
      },
      "thread_name":"question_all_confirm"
    },
    {"type": "comment", "data":"====================================="},
    {
      "type": "message", 
      "text": "ありがとうございました。「{{vars.username}}」様の個人情報を今後の業務連絡だけに使いさせて頂きます。",
      "thread_name":"userinfo_confirm_completed"
    },
    {
      "type": "message", 
      "action": "completed",
      "thread_name":"userinfo_confirm_completed"
    },
    {"type": "comment", "data":"====================================="}

  ]
}